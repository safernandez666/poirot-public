apiVersion: v1
kind: Secret
metadata:
  name: {{ include "poirot.fullname" . }}-secret
  namespace: {{ .Values.namespace.name }}
  labels: {{ include "poirot.labels" . | nindent 4 }}
type: Opaque
stringData:
  # ── Slack ──────────────────────────────────────────────────────────────────
  SLACK_ENABLED: {{ .Values.slack.enabled | toString | quote }}
  SLACK_WEBHOOK_URL: {{ .Values.slack.webhookUrl | quote }}

  # ── SMTP ───────────────────────────────────────────────────────────────────
  SMTP_ENABLED: {{ .Values.smtp.enabled | toString | quote }}
  SMTP_HOST: {{ .Values.smtp.host | quote }}
  SMTP_PORT: {{ .Values.smtp.port | quote }}
  SMTP_USE_TLS: {{ .Values.smtp.useTls | quote }}
  SMTP_USERNAME: {{ .Values.smtp.username | quote }}
  SMTP_PASSWORD: {{ .Values.smtp.password | quote }}
  SMTP_FROM_ADDRESS: {{ .Values.smtp.fromAddress | quote }}
  SMTP_FROM_NAME: {{ .Values.smtp.fromName | quote }}
  SMTP_TO_ADDRESSES: {{ .Values.smtp.toAddresses | quote }}
  SMTP_EMAIL_THEME: {{ .Values.smtp.emailTheme | quote }}

  # ── TheHive ────────────────────────────────────────────────────────────────
  THEHIVE_ENABLED: {{ .Values.thehive.enabled | toString | quote }}
  THEHIVE_URL: {{ .Values.thehive.url | quote }}
  THEHIVE_API_KEY: {{ .Values.thehive.apiKey | quote }}

  # ── Ollama ─────────────────────────────────────────────────────────────────
  OLLAMA_ENABLED: {{ .Values.ollama.enabled | toString | quote }}
  OLLAMA_URL: {{ .Values.ollama.url | quote }}
  OLLAMA_MODEL: {{ .Values.ollama.model | quote }}

  # ── Data Sources ───────────────────────────────────────────────────────────
  # Generated from values.sources — each entry becomes SOURCE_TYPE_NAME=<json>
  {{- range $type, $instances := .Values.sources }}
  {{- range $name, $cfg := $instances }}
  SOURCE_{{ $type | upper }}_{{ $name | upper | replace "-" "_" }}: {{ $cfg | toJson | quote }}
  {{- end }}
  {{- end }}
